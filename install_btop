#!/bin/bash

set -e

echo "üì¶ –°–∫–∞—á–∏–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é —Å–±–æ—Ä–∫—É btop++..."
wget -q --show-progress https://github.com/aristocratos/btop/releases/latest/download/btop-x86_64-linux-musl.tbz

echo "üì¶ –†–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ–º –∞—Ä—Ö–∏–≤..."
tar -xvjf btop-x86_64-linux-musl.tbz >/dev/null

cd btop || { echo "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–µ—Ä–µ–π—Ç–∏ –≤ –ø–∞–ø–∫—É btop"; exit 1; }

echo "üîß –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º btop++..."
sudo make install

echo "‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏
echo
btop --version
echo

# –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–∞, –µ—Å–ª–∏ –µ—â—ë –Ω–µ—Ç
mkdir -p ~/.config/btop
if [ ! -f ~/.config/btop/btop.conf ]; then
    echo "üß∞ –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ñ–∏–≥–∞..."
    timeout 2s btop >/dev/null 2>&1 || true
fi

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–º—ã Candy
echo "üé® –í–∫–ª—é—á–∞–µ–º —Ç–µ–º—É Candy..."
sed -i 's/^color_theme = .*/color_theme = "Candy"/' ~/.config/btop/btop.conf

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∞–º–æ–π —Ç–µ–º—ã (–µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–∏–ª–∞—Å—å)
if [ ! -f /usr/share/btop/themes/candy.theme ]; then
    echo "‚¨áÔ∏è –°–∫–∞—á–∏–≤–∞–µ–º —Ç–µ–º—É candy..."
    sudo wget -q https://raw.githubusercontent.com/aristocratos/btop/main/themes/candy.theme -O /usr/share/btop/themes/candy.theme
fi

echo
echo "üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
echo "üëâ –î–ª—è –∑–∞–ø—É—Å–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –≤–≤–µ–¥–∏—Ç–µ: btop"
echo "‚ùå –î–ª—è –≤—ã—Ö–æ–¥–∞ –Ω–∞–∂–º–∏—Ç–µ Ctrl+C –≤–Ω—É—Ç—Ä–∏ btop"
